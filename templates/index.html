<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Local YouTube Playlist Player</title>
  <!-- Favicon using emoji -->
  <link rel="icon" href="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üéµ</text></svg>">
  <!-- Common player styles -->
  <link rel="stylesheet" href="/static/css/player-common.css">
  <!-- Index player specific styles -->
  <link rel="stylesheet" href="/static/css/index-player.css">
  <!-- Icons styles -->
  <link rel="stylesheet" href="/static/css/player-icons.css">
  <script>
    // Local server IP injected by Flask for proper Cast functionality
    const SERVER_IP = "{{ server_ip }}";
    // Relative path of playlist (sub-folder) ‚Äì empty for root / all tracks
    const PLAYLIST_REL = "{{ playlist_rel|default('') }}";
  </script>
</head>
<body>
  <div id="shareOverlay" style="display:none;position:fixed;top:20px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.8);color:#fff;padding:10px 14px;border-radius:6px;font-size:14px;z-index:9999;">
    Stream URL: <a id="shareLink" href="#" target="_blank" style="color:#61dafb;word-break:break-all;"></a>
    <button id="copyLinkBtn" style="margin-left:8px;">Copy</button>
    <button id="closeShare" style="margin-left:4px;">‚úï</button>
  </div>
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
    <a href="/" style="color:#61dafb;text-decoration:none;font-size:16px;">‚Üê All Playlists</a>
    <span style="font-size:16px;color:var(--text);">{{ playlist_name }}</span>
  </div>
  <div id="controlBar" class="control-bar">
    <button id="shuffleBtn" class="modern-btn modern-btn-accent">
      <span class="icon icon-shuffle"></span>
      <span>Shuffle</span>
    </button>
    <button id="smartShuffleBtn" class="modern-btn modern-btn-accent">
      <span class="icon icon-smart-shuffle"></span>
      <span>Smart</span>
    </button>
    <button id="orderByDateBtn" class="modern-btn modern-btn-accent">
      <span class="icon icon-order-by-date"></span>
      <span>Order by Date</span>
    </button>
    <button id="deleteCurrentBtn" class="modern-btn modern-btn-danger">
      <span class="icon icon-delete"></span>
      <span>Delete</span>
    </button>
    <button id="streamBtn" class="modern-btn modern-btn-success">
      <span class="icon icon-stream"></span>
      <span>Stream</span>
    </button>
    <button id="fullBtn" class="modern-btn modern-btn-secondary">
      <span class="icon icon-full"></span>
      <span>Full</span>
    </button>
    <button id="toggleListBtn" class="modern-btn modern-btn-outline">
      <span class="icon icon-list"></span>
      <span>Playlist</span>
    </button>
  </div>
  <div id="playerContainer" class="player-container" style="margin-top:10px; position:relative;">
    <div id="videoWrapper" style="position:relative; flex:1 1 auto;">
      <video id="player" style="width:100%;" playsinline></video>
      
      <!-- custom control bar -->
      <div id="customControls" class="controls">
        <div class="left-group">
          <button id="cPrev" class="ctrl-btn" title="Previous">
            <span class="icon icon-prev"></span>
          </button>
          <button id="cPlay" class="ctrl-btn" title="Play/Pause">
            <span class="icon icon-play"></span>
          </button>
          <button id="cNext" class="ctrl-btn" title="Next">
            <span class="icon icon-next"></span>
          </button>
          <button id="cLike" class="ctrl-btn" title="Like">
            <span class="icon icon-like"></span>
          </button>
          <button id="cDislike" class="ctrl-btn" title="Dislike">
            <span class="icon icon-dislike"></span>
          </button>
          <button id="cYoutube" class="ctrl-btn" title="Open on YouTube">
            <span class="icon icon-youtube"></span>
          </button>
          <button id="castBtn" class="ctrl-btn" title="Play on TV">
            <span class="icon icon-cast"></span>
          </button>
          <button id="cMute" class="ctrl-btn" title="Mute/Unmute">
            <span class="icon icon-volume"></span>
          </button>
          <input type="range" id="cVol" min="0" max="1" step="0.01" value="1" class="vol-slider" />
          <button id="cSpeed" class="ctrl-btn" title="Playback Speed: 1x">
            <span class="icon icon-clock"></span>
            <span id="speedLabel">1x</span>
          </button>
        </div>
        <div id="progressContainer" class="progress"><div id="progressBar" class="progress-bar"></div></div>
        <span id="timeLabel" class="time">0:00 / 0:00</span>
        <button id="cFull" class="ctrl-btn" title="Fullscreen">
          <span class="icon icon-full"></span>
        </button>
      </div>
    </div>
    
    <!-- Current track title display -->
    <div id="currentTrackTitle">
      <span id="currentTrackName">No track selected</span>
    </div>
    
    <div id="playlistPanel" class="playlist-panel">
      <ul id="tracklist" class="side-list"></ul>
    </div>
  </div>

<!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è track title manager –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã ResizeObserver -->
<script type="module">
  import { initializeTrackTitleManager } from '/static/js/modules/track-title-manager.js';
  initializeTrackTitleManager();
</script>
<script type="module" src="/static/player.js"></script>
  <script>
    // Load Google Cast API with detailed debugging
    console.log('üîÑ CAST DEBUG: Starting Google Cast API script loading...');
    
    const castScript = document.createElement('script');
    castScript.src = 'https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1';
    
    castScript.onerror = function(error) {
      console.error('‚ùå CAST DEBUG: Failed to load Google Cast API script!');
      console.error('‚ùå CAST DEBUG: Script error details:', error);
      console.log('üîÑ CAST DEBUG: Attempting fallback behavior...');
      
      // Fallback: try to show cast button anyway
      const castBtn = document.getElementById('castBtn');
      if(castBtn) {
        castBtn.style.display = 'inline-flex';
        castBtn.style.opacity = '0.5';
        castBtn.title = 'Cast API not available';
        console.log('‚úÖ CAST DEBUG: Cast button shown with API unavailable indicator');
      } else {
        console.error('‚ùå CAST DEBUG: Cast button not found during fallback');
      }
    };
    
    castScript.onload = function() {
      console.log('‚úÖ CAST DEBUG: Google Cast API script loaded successfully!');
      console.log('üîÑ CAST DEBUG: Waiting for Cast framework to initialize...');
      
      // Check if Cast API objects are available
      setTimeout(() => {
        console.log('üîç CAST DEBUG: Checking Cast API availability...');
        console.log('üîç CAST DEBUG: window.cast available:', typeof window.cast !== 'undefined');
        console.log('üîç CAST DEBUG: chrome.cast available:', typeof chrome !== 'undefined' && typeof chrome.cast !== 'undefined');
        
        if(typeof window.__onGCastApiAvailable === 'function') {
          console.log('‚úÖ CAST DEBUG: Cast API callback function is ready');
        } else {
          console.warn('‚ùå CAST DEBUG: Cast API callback function not found!');
        }
      }, 100);
    };
    
    console.log('üîÑ CAST DEBUG: Appending Cast API script to document head...');
    document.head.appendChild(castScript);
    console.log('‚úÖ CAST DEBUG: Cast API script element added to DOM');
    
  </script>
</body>
</html> 